{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=yes">
    <title>MyAIFactChecker</title>
    
    <!-- Meta Tags for SEO -->
    <meta name="description" content="AI Fact Checker for verifying information." />
    <meta name="keywords" content="AI Fact Checker, fact verification, AI tool for verifying information, online fact checker" />

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Nunito:400,600,700" rel="stylesheet">

    <!-- CSS Styles -->
    <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/select2.min.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/chatBot.css' %}">
    <link rel="stylesheet" type="text/css" href="{% static 'css/timeline.css' %}">
    <link rel="stylesheet" href="{% static 'output.css' %}">
    <link rel="stylesheet" href="{% static 'w3.css' %}">

    <!-- jQuery Library -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <style>
        /* Style for the chat icon */
        #chat-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            cursor: pointer;
        }

        /* Result container styling */
        #resultContainer {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            display: none;
        }

        #resultContainer ul {
            list-style-type: none;
            padding: 0;
        }

        #resultContainer li {
            margin-bottom: 15px;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }

        #resultContainer li:last-child {
            border-bottom: none;
        }

        .loading {
            font-size: 18px;
            color: #007bff;
        }
    </style>

</head>
<body>

    <header class="fixed w-full">
        <nav class="bg-white border-gray-200 py-2.5 dark:bg-gray-900">
            <div class="flex flex-wrap items-center justify-between max-w-screen-xl px-4 mx-auto">
                <a href="/" class="flex items-center">
                    <img src="{% static '/images/Factcheck_Elections.png' %}" class="h-6 mr-3 sm:h-9" alt="FactCheck Logo" />
                </a>
            </div>
        </nav>
    </header>

    <main style="display: flex; justify-content: center; align-items: center; padding-bottom: 150px;">
        <section style="width: 100%; max-width: 600px; margin: auto;">
            <div class="max-w-screen-md mx-auto mb-8 text-center">
                <h2 class="mb-4 text-3xl tracking-tight text-gray-900 dark:text-white">
                    Enter the webpage URL you want to fact-check
                </h2>
            </div>

            <!-- Fact-Checking Form -->
            <form id="factCheckForm">
                <div class="mb-4 border border-gray-200 rounded-lg bg-gray-50 dark:bg-gray-700 dark:border-gray-600 p-4">
                    <label for="webpage_url" class="sr-only">Enter the Webpage URL:</label>
                    <input type="url" id="webpage_url" name="webpage_url"
                           class="w-full block mx-auto text-lg px-4 py-3 text-gray-800 bg-gray-100 border-2 border-gray-300 rounded-lg 
                                  dark:bg-gray-800 dark:border-gray-600 focus:ring-2 focus:ring-teal-500 dark:text-white dark:placeholder-gray-400" 
                           placeholder="https://example.com" required>
                </div>

                <div class="w3-container w3-center w3-padding">
                    <button style="width: 100%; padding: 15px; font-size: 18px;" 
                            class="w3-button w3-teal w3-round-xlarge" 
                            type="submit">
                        Check Authenticity
                    </button>
                </div>
            </form>

            <!-- Fact-Check Results -->
            <div id="resultContainer"></div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="bg-white dark:bg-gray-800">
        <div class="max-w-screen-xl p-4 mx-auto">
            <hr class="my-6 border-gray-200 sm:mx-auto dark:border-gray-700">
            <div class="text-gray-500 dark:text-gray-400">Â© 2025 MyAIFactChecker.</div>
        </div>
    </footer>

    <!-- jQuery AJAX Fact-Checking Logic -->
    <script>
    $(document).ready(function () {
        $("#factCheckForm").submit(function (event) {
            event.preventDefault(); // Prevent default form submission

            var webpageUrl = $("#webpage_url").val().trim();

            if (webpageUrl === "") {
                alert("Please enter a webpage URL.");
                return;
            }

            // Show loading indicator
            $("#resultContainer").html('<p class="loading">Checking authenticity... Please wait.</p>').show();

            $.ajax({
                url: "https://myapiprojects-production.up.railway.app/api/webpage-url/",
                type: "POST",
                contentType: "application/json",
                data: JSON.stringify({ "webpage_url": webpageUrl }),
                success: function (response) {
                    console.log(response);

                    if (response.result) {
                        var outputHtml = "<h3>Fact-Checking Result:</h3>";

                        if (response.result.claims && response.result.claims.length > 0) {
                            outputHtml += "<ul>";
                            response.result.claims.forEach(function (claim) {
                                outputHtml += `
                                    <li>
                                        <strong>Claim:</strong> ${claim.claim} <br>
                                        <strong>Verdict:</strong> <span style="color: ${claim.verdict === 'False' ? 'red' : 'green'};">${claim.verdict}</span> <br>
                                        <strong>Evidence:</strong> ${claim.evidence} <br>
                                        <strong>Sources:</strong> <ul>${claim.sources.map(src => `<li><a href="${src}" target="_blank">${src}</a></li>`).join('')}</ul>
                                    </li>
                                `;
                            });
                            outputHtml += "</ul>";
                        } else {
                            outputHtml += "<p>No claims detected to fact-check.</p>";
                        }

                        $("#resultContainer").html(outputHtml);
                    } else {
                        $("#resultContainer").html("<p>Error: Unable to retrieve fact-checking results.</p>");
                    }
                },
                error: function (xhr, status, error) {
                    console.error("Error:", error);
                    $("#resultContainer").html("<p style='color: red;'>An error occurred while processing the request.</p>");
                }
            });
        });
    });
    </script>

</body>
</html>
